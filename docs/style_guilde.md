# Style guide

[–í–¥–æ—Ö–Ω–æ–≤–∏–ª—Å—è –ø–æ –±–æ–ª—å—à–µ–π —á–∞—Å—Ç–∏ –æ—Ç —Å—é–¥–∞](https://github.com/HackSoftware/Django-Styleguide)

<!-- MarkdownTOC autolink="true" -->

- [–í–≤–µ–¥–µ–Ω–∏–µ](#%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5)
- [FAQ?](#faq)
- [–ú–æ–¥–µ–ª–∏](#%D0%9C%D0%BE%D0%B4%D0%B5%D0%BB%D0%B8)
  - [–ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å](#%D0%91%D0%B0%D0%B7%D0%BE%D0%B2%D0%B0%D1%8F-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C)
  - [–í–∞–ª–∏–¥–∞—Ü–∏—è](#%D0%92%D0%B0%D0%BB%D0%B8%D0%B4%D0%B0%D1%86%D0%B8%D1%8F)
  - [–í–∞–ª–∏–¥–∞—Ü–∏—è - constraints](#%D0%92%D0%B0%D0%BB%D0%B8%D0%B4%D0%B0%D1%86%D0%B8%D1%8F---constraints)
  - [–°–≤–æ–π—Å—Ç–≤–∞](#%D0%A1%D0%B2%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%B0)
  - [–ú–µ—Ç–æ–¥—ã](#%D0%9C%D0%B5%D1%82%D0%BE%D0%B4%D1%8B)
- [–°–µ—Ä–≤–∏—Å—ã](#%D0%A1%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D1%8B)
  - [–°–æ–≥–ª–∞—à–µ–Ω–∏–µ –æ–± –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏](#%D0%A1%D0%BE%D0%B3%D0%BB%D0%B0%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BE%D0%B1-%D0%B8%D0%BC%D0%B5%D0%BD%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B8)
  - [–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤](#%D0%A0%D0%B0%D1%81%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BB%D0%BE%D0%B3%D0%B8%D0%BA%D0%B8-%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2)
  - [–°–µ–ª–µ–∫—Ç–æ—Ä—ã](#%D0%A1%D0%B5%D0%BB%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D1%8B)
  - [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#%D0%A2%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)
- [APIs & Serializers](#apis--serializers)
- [Serializers](#serializers)
  - [–°–æ–≥–ª–∞—à–µ–Ω–∏–µ –æ–± –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏](#%D0%A1%D0%BE%D0%B3%D0%BB%D0%B0%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BE%D0%B1-%D0%B8%D0%BC%D0%B5%D0%BD%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B8-1)
  - [–§–∏–ª—å—Ç—Ä—ã](#%D0%A4%D0%B8%D0%BB%D1%8C%D1%82%D1%80%D1%8B)
- [–û—à–∏–±–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π](#%D0%9E%D1%88%D0%B8%D0%B1%D0%BA%D0%B8-%D0%B8-%D0%BE%D0%B1%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0-%D0%B8%D1%81%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B9)
  - [–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π \(–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ DRF\)](#%D0%9A%D0%B0%D0%BA-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82-%D0%BE%D0%B1%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0-%D0%B8%D1%81%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B9-%D0%B2-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%BA%D1%81%D1%82%D0%B5-drf)
    - [DRF's `ValidationError`.](#drfs-validationerror)
    - [Django's `ValidationError`.](#djangos-validationerror)
  - [–ö–∞–∫ –¥–æ–ª–∂–Ω—ã –≤—ã–≥–ª—è–¥–µ—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ \(–ø–æ–∫–∞ –Ω–µ –≤–Ω–µ–¥—Ä—è—Ç—å, –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏ —Ñ—Ä–æ–Ω—Ç–∞–º–∏\)](#%D0%9A%D0%B0%D0%BA-%D0%B4%D0%BE%D0%BB%D0%B6%D0%BD%D1%8B-%D0%B2%D1%8B%D0%B3%D0%BB%D1%8F%D0%B4%D0%B5%D1%82%D1%8C-%D0%B8%D0%B4%D0%B5%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B8-%D0%B2-%D0%BD%D0%B0%D1%88%D0%B5%D0%BC-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B5-%D0%BF%D0%BE%D0%BA%D0%B0-%D0%BD%D0%B5-%D0%B2%D0%BD%D0%B5%D0%B4%D1%80%D1%8F%D1%82%D1%8C-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B3%D0%BB%D0%B0%D1%81%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B8-%D1%84%D1%80%D0%BE%D0%BD%D1%82%D0%B0%D0%BC%D0%B8)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#%D0%A2%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-1)
  - [–°–æ–≥–ª–∞—à–µ–Ω–∏—è –æ–± –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏](#%D0%A1%D0%BE%D0%B3%D0%BB%D0%B0%D1%88%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BE%D0%B1-%D0%B8%D0%BC%D0%B5%D0%BD%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B8)
- [Celery](#celery)
  - [–°—Ç—Ä—É–∫—Ç—É—Ä–∞](#%D0%A1%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%B0)
    - [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#%D0%9A%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F)
    - [Tasks –∏–ª–∏ –∂–µ –∑–∞–¥–∞—á–∏](#tasks-%D0%B8%D0%BB%D0%B8-%D0%B6%D0%B5-%D0%B7%D0%B0%D0%B4%D0%B0%D1%87%D0%B8)
    - [Celery beat –∏–ª–∏ –∑–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é](#celery-beat-%D0%B8%D0%BB%D0%B8-%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA-%D0%B7%D0%B0%D0%B4%D0%B0%D1%87%D0%B8-%D0%BF%D0%BE-%D1%80%D0%B0%D1%81%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D1%8E)

<!-- /MarkdownTOC -->

## –í–≤–µ–¥–µ–Ω–∏–µ

**–í Django –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –∂–∏—Ç—å –≤:**.

- –°–µ—Ä–≤–∏—Å—ã - —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∑–∞–Ω–∏–º–∞—é—Ç—Å—è –∑–∞–ø–∏—Å—å—é –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
- –°–µ–ª–µ–∫—Ç–æ—Ä—ã - —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∑–∞–±–æ—Ç—è—Ç—Å—è –æ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
- –§—É–Ω–∫—Ü–∏–∏ –º–æ–¥–µ–ª–∏ (–µ—Å–ª–∏ –ª–æ–≥–∏–∫–∞ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç, –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏).

**–í Django –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –∂–∏—Ç—å –≤:**.

- API –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è—Ö.
- –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞—Ö –∏ —Ñ–æ—Ä–º–∞—Ö.
- –ú–µ—Ç–æ–¥ `save` –º–æ–¥–µ–ª–∏.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã –∏–ª–∏ –Ω–∞–±–æ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤.
- –°–∏–≥–Ω–∞–ª—ã.

**–§—É–Ω–∫—Ü–∏–∏ –º–æ–¥–µ–ª–∏ –ø—Ä–æ—Ç–∏–≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤:**

- –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–≤—è–∑–µ–π —Å –º–æ–¥–µ–ª—è–º–∏, —Ç–æ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä.
- –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω–∞, –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ 10 —Å—Ç—Ä–æ–∫ –∏–ª–∏ –º–æ–∂–µ—Ç –ª–µ–≥–∫–æ –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É `N + 1` –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏, —Ç–æ –ª—É—á—à–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º.

–û–±—â–∞—è –∏–¥–µ—è —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã "—Ä–∞–∑–¥–µ–ª–∏—Ç—å –∑–æ–Ω—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏", —á—Ç–æ–±—ã –æ–Ω–∏ –±—ã–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã.

## FAQ?

> ü§î –ü–æ—á–µ–º—É –±—ã –Ω–µ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ API / –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è—Ö / —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞—Ö / —Ñ–æ—Ä–º–∞—Ö? –°–µ–π—á–∞—Å –∂–µ –Ω–æ—Ä–º –≤—Ä–æ–¥–µ –≤—Å–µ!

–Ø –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–µ–∫—Ç–æ–≤, –∏ –ø–æ —Ñ–∞–∫—Ç—É —É –Ω–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ 1 –ø–∞—Ç—Ç–µ—Ä–Ω: –ª–æ–≥–∏–∫–∞ –æ–±—ã—á–Ω–æ –æ–ø–∏—Å–∞–Ω–∞ –≤ `actions`, –≤ `serializers` –∏–ª–∏ –≤ `querysets`.
–≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø—Ä–æ–±–ª–µ–º–µ: —á—Ç–æ –±—ã –ø–æ–Ω—è—Ç—å –ª–æ–≥–∏–∫—É, —É—Å–ª–æ–≤–Ω–æ, –≤—ã–≤–æ–¥–∞ —Ö–æ–¥–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞, —Ç–µ–±–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–±–µ–∂–∞—Ç—å—Å—è –ø–æ 3-4 —Ñ–∞–π–ª–∞–º.

–ü–ª—é—Å –±–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞ —á–∞—Å—Ç–æ –ø–ª—è—à–µ—Ç –º–µ–∂–¥—É —ç—Ç–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏, —Ç.–µ. —Ç–µ–±–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å—Å—è –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –∫ —É–∂–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ 7-8 –ø—Ä—ã–∂–∫–∞–º –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏.

Generic APIs & Views, –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞–º–∏, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ CRUD.
–ù–æ —á–∞—Å—Ç–æ —É –Ω–∞—Å –ª–æ–≥–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ "–≤–Ω—É—Ç—Ä–∏" CRUD, —Ç–∞–∫ –ø–ª—é—Å–æ–º –µ—â–µ –∏–¥—É—Ç `actions`.
–ò –≤–æ—Ç —Ç—É—Ç —É–∂–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –∫–∞–∫ —Ö–æ—á–µ—Ç, –ø—Ä–∏—á–µ–º –ø–æ-—Ä–∞–∑–Ω–æ–º—É –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö(—è —Å–∞–º —Ç–∞–∫ –¥–µ–ª–∞–ª, –∫–∞—é—Å—å...).
–≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç —á–∞—Å—Ç–æ —Å–∫—Ä—ã—Ç—ã–π –Ω–µ–≥–∞—Ç–∏–≤, —É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç–æ–º –ø—Ä–∞–≤—è—Ç —Ç–∞–∫–æ–π –∫–æ–¥. –ß—Ç–æ –±—ã —ç—Ç–æ–≥–æ –±—ã–ª–æ –ø–æ–º–µ–Ω—å—à–µ, —Ä–µ—à–µ–Ω–æ –±—ã–ª–æ –Ω–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–π style guide.

> ü§î –ü–æ—á–µ–º—É –±—ã –Ω–µ –ø–æ–º–µ—Å—Ç–∏—Ç—å –Ω–∞—à—É –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã(Manager) –∏/–∏–ª–∏ –Ω–∞–±–æ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤(QuerySets)?
> –°–µ–π—á–∞—Å –∂–µ –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö —Ç–∞–∫ –∏ –µ—Å—Ç—å, —É–¥–æ–±–Ω–æ –∂–µ!

–ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –º—ã —ç—Ç–æ—Ç –¥–µ–ª–∞–µ–º –ø–æ —Ñ–∞–∫—Ç—É –Ω–∞ –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö, —ç—Ç–æ –æ—á–µ–Ω—å —É–¥–æ–±–Ω–æ, –∫–æ–≥–¥–∞ —Ç–∞–∫–∞—è –ª–æ–≥–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –º–æ–¥—É–ª–µ–π(–Ω–∞–ø—Ä–∏–º–µ—Ä requests).

–ü—Ä–æ–±–ª–µ–º—ã –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è –∫–æ–≥–¥–∞ –º—ã –Ω–∞—á–∏–Ω–∞–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Å—Ä–µ–¥–Ω–µ-–±–æ–ª—å—à–∏–µ –º–æ–¥—É–ª–∏, —Å —Ç–æ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏(–Ω–∞–ø—Ä–∏–º–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–ª–∏ –æ–±—ä–µ–∫—Ç—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏).

–ü–æ—ç—Ç–æ–º—É –ø—ã—Ç–∞—Ç—å—Å—è –ø–æ–º–µ—Å—Ç–∏—Ç—å –≤—Å—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä - –Ω–µ –≤—Å–µ–≥–¥–∞ —Å–∞–º–∞—è –ª—É—á—à–∞—è –∏–¥–µ—è, –ø–æ—Ç–æ–º—É —á—Ç–æ:

1. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏–º–µ–µ—Ç —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –≤—Å–µ–≥–¥–∞ –Ω–∞–ø—Ä—è–º—É—é —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω —Å –≤–∞—à–µ–π –º–æ–¥–µ–ª—å—é –¥–∞–Ω–Ω—ã—Ö (–º–æ–¥–µ–ª—è–º–∏).
2. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —á–∞—â–µ –≤—Å–µ–≥–æ –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ–¥–µ–ª–µ–π, –ø–æ—ç—Ç–æ–º—É –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å, –≥–¥–µ —á—Ç–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å.
   1. –î–æ–ø—É—Å—Ç–∏–º, —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —á–∞—Å—Ç—å –ª–æ–≥–∏–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –º–æ–¥–µ–ª–∏ `A`, `B`, `C` –∏ `D`. –ö—É–¥–∞ –≤—ã –µ–≥–æ –ø–æ–º–µ—Å—Ç–∏—Ç–µ?
3. –ú–æ–≥—É—Ç –±—ã—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–º —Å–∏—Å—Ç–µ–º–∞–º(CRM, mailgun –∏ etc).

**–ò–¥–µ—è —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã –ø–æ–∑–≤–æ–ª–∏—Ç—å –≤–∞—à–µ–π –ª–æ–≥–∏–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∂–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –≤–∞—à–µ–π –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–ª–æ—è API.**.

–ï—Å–ª–∏ –º—ã –≤–æ–∑—å–º–µ–º –∏–¥–µ—é —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –Ω–∞–±–æ—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤/–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –∏ –æ–±—ä–µ–¥–∏–Ω–∏–º –µ–µ —Å –∏–¥–µ–µ–π –ø–æ–∑–≤–æ–ª–∏—Ç—å –ª–æ–≥–∏–∫–µ –∂–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ, –º—ã –ø–æ–ª—É—á–∏–º —Ç–æ, —á—Ç–æ –º—ã –Ω–∞–∑—ã–≤–∞–µ–º "—Å–ª–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤".

**–°–µ—Ä–≤–∏—Å—ã –º–æ–≥—É—Ç –±—ã—Ç—å —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –∫–ª–∞—Å—Å–∞–º–∏, –º–æ–¥—É–ª—è–º–∏ –∏–ª–∏ —á–µ–º —É–≥–æ–¥–Ω–æ, —á—Ç–æ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–ª—É—á–∞—è.**

–£—á–∏—Ç—ã–≤–∞—è –≤—Å–µ —ç—Ç–æ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã –∏ –Ω–∞–±–æ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —è–≤–ª—è—é—Ç—Å—è –æ—á–µ–Ω—å –º–æ—â–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ª—É—á—à–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –¥–ª—è –≤–∞—à–∏—Ö –º–æ–¥–µ–ª–µ–π.

> ü§î –ü–æ—á–µ–º—É –±—ã –Ω–µ –ø–æ–º–µ—Å—Ç–∏—Ç—å –Ω–∞—à—É –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ —Å–∏–≥–Ω–∞–ª—ã? –ü–æ —Ñ–∞–∫—Ç—É —ç—Ç–æ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫—Ä—ã—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å–µ—Ä–≤–∏—Å–æ–≤.

–ö–∞–∫ –ø–æ–∫–∞–∑–∞–ª–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∏ –Ω–∞ —Å–∏–≥–Ω–∞–ª–∞—Ö: —ç—Ç–æ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–∞–ª—å–±–æ–π –ø–æ –∫–æ–ª–µ–Ω—è–º.
–†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ –≤—ã–∑–æ–≤—ã —Å–∏–≥–Ω–∞–ª–æ–≤, —Å–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏ –∏ –∏–Ω–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ pre_save - —ç—Ç–æ –æ—á —Å–∏–ª—å–Ω–æ –º–µ—à–∞–µ—Ç –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∏ —á–∏—Å—Ç—É—é –ª–æ–≥–∏–∫—É.

–ù–æ –≤—Å–µ –∂–µ:

1. –°–∏–≥–Ω–∞–ª—ã —Ç–∞–∫–∂–µ —è–≤–ª—è—é—Ç—Å—è –æ—Ç–ª–∏—á–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º **–¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫—ç—à–∞** –≤–Ω–µ —É—Ä–æ–≤–Ω—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.
2. –°–∏–≥–Ω–∞–ª—ã —è–≤–ª—è—é—Ç—Å—è –¥–æ–≤–æ–ª—å–Ω–æ —Ö–æ—Ä–æ—à–∏–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ callback —Ñ—É–∫–Ω—Ü–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ **–æ–¥–Ω–æ–≥–æ** –æ–±—ä–µ–∫—Ç–∞.

–ü–æ—ç—Ç–æ–º—É –≤ –æ–±—â–µ–º –≤–∏–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã –Ω—É–∂–Ω–æ, –Ω–æ –≤—Å–µ–≥–¥–∞ –Ω—É–∂–Ω–æ **–∏—Å—Ö–æ–¥–∏—Ç—å –∏–∑ –∑–¥—Ä–∞–≤–æ–≥–æ —Å–º—ã—Å–ª–∞**.

## –ú–æ–¥–µ–ª–∏

–ú–æ–¥–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–µ –±–æ–ª–µ–µ —Ç–æ–≥–æ.

### –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å

–•–æ—Ä–æ—à–µ–π –∏–¥–µ–µ–π –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å `BaseModel`, –∫–æ—Ç–æ—Ä—É—é –≤—ã –º–æ–∂–µ—Ç–µ —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å.

–û–±—ã—á–Ω–æ —Ç–∞–∫–∏–µ –ø–æ–ª—è, –∫–∞–∫ `created_at` –∏ `updated_at` —è–≤–ª—è—é—Ç—Å—è –∏–¥–µ–∞–ª—å–Ω—ã–º–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ `BaseModel`.

–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –ø–æ–ø–∞—Å—Ç—å —Ç—É–¥–∞. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–º –¥–ª—è —ç—Ç–æ–≥–æ —è–≤–ª—è–µ—Ç—Å—è [`UUIDField`](https://docs.djangoproject.com/en/dev/ref/models/fields/#uuidf).

–í–æ—Ç –ø—Ä–∏–º–µ—Ä `BaseModel`:

```python
from django.db import models
from django.utils import timezone


class BaseModel(models.Model):
    created_at = models.DateTimeField(db_index=True, default=timezone.now)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        abstract = True
```

–ó–∞—Ç–µ–º, –∫–æ–≥–¥–∞ –≤–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –Ω–æ–≤–∞—è –º–æ–¥–µ–ª—å, –ø—Ä–æ—Å—Ç–æ –Ω–∞—Å–ª–µ–¥—É–π—Ç–µ `BaseModel`:

```python
class SomeModel(BaseModel):
    pass
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è

–î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –ø—Ä–∏–º–µ—Ä –º–æ–¥–µ–ª–∏:

```python
class Course(BaseModel):
    name = models.CharField(unique=True, max_length=255)

    start_date = models.DateField()
    end_date = models.DateField()

    def clean(self):
        if self.start_date >= self.end_date:
            raise ValidationError("–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –Ω–∞—á–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã")
```

–ú—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–æ–¥ `clean` –º–æ–¥–µ–ª–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –º—ã —Ö–æ—Ç–∏–º —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º—ã –ø–æ–ª—É—á–∞–µ–º –≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

–¢–µ–ø–µ—Ä—å, —á—Ç–æ–±—ã –º–µ—Ç–æ–¥ `clean` –±—ã–ª –≤—ã–∑–≤–∞–Ω, –∫—Ç–æ-—Ç–æ –¥–æ–ª–∂–µ–Ω –≤—ã–∑–≤–∞—Ç—å `full_clean` –¥–ª—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –Ω–∞—à–µ–π –º–æ–¥–µ–ª–∏ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.

**–ù–∞—à–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è - —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –≤ —Å–µ—Ä–≤–∏—Å–µ, –ø—Ä—è–º–æ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º clean:**.

```python
def course_create(*, name: str, start_date: date, end_date: date) -> Course:
    obj = Course(name=name, start_date=start_date, end_date=end_date)

    obj.full_clean()
    obj.save()

    return obj
```

–≠—Ç–æ —Ç–∞–∫–∂–µ —Ö–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∞–¥–º–∏–Ω–∫–æ–π Django, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ñ–æ—Ä–º—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–º, –±—É–¥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å `full_clean` –Ω–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–µ.

**–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—â–∏—Ö –ø—Ä–∞–≤–∏–ª, –∫–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ –º–µ—Ç–æ–¥ `clean` –º–æ–¥–µ–ª–∏:**.

1. –ï—Å–ª–∏ –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö **–Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π**, —Ç.–µ. —ç—Ç–æ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å ForeignKey –∏ ManyToMany.
2. –ï—Å–ª–∏ —Å–∞–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–∞.

**–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å, –µ—Å–ª–∏:**

1. –õ–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–ª–æ–∂–Ω–∞—è.
2. –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö(–∏–∑ CRM –Ω–∞–ø—Ä–∏–º–µ—Ä).

### –í–∞–ª–∏–¥–∞—Ü–∏—è - constraints

–ú–µ–Ω—å—à–µ –∫–æ–¥–∞ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å, –º–µ–Ω—å—à–µ –∫–æ–¥–∞ –Ω—É–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∑–∞–±–æ—Ç–∏—Ç—Å—è –æ –¥–∞–Ω–Ω—ã—Ö, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã –∏–∑ –¥—Ä—É–≥–æ–≥–æ –º–µ—Å—Ç–∞.

```python
class Course(BaseModel):
    name = models.CharField(unique=True, max_length=255)

    start_date = models.DateField()
    end_date = models.DateField()

    class Meta:
        –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è = [
            constraints.CheckConstraint(
                name="start_date_before_end_date",
                check=Q(start_date__lt=F("end_date"))
            )
        ]
```

–¢–µ–ø–µ—Ä—å, –µ—Å–ª–∏ –º—ã –ø–æ–ø—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç —á–µ—Ä–µ–∑ `course.save()` –∏–ª–∏ —á–µ—Ä–µ–∑ `Course.objects.create(...)`, –º—ã –ø–æ–ª—É—á–∏–º `IntegrityError`, –∞ –Ω–µ `ValidationError`.

–ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–º –ø–æ–¥—Ö–æ–¥–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–µ–ø–µ—Ä—å –Ω–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –∏–º–µ—Ç—å –¥–µ–ª–æ —Å `IntegrityError`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ.

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Django –ø–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º –¥–æ–≤–æ–ª—å–Ω–æ —Å–∫—É–¥–Ω–∞—è, –ø–æ—ç—Ç–æ–º—É –≤—ã –º–æ–∂–µ—Ç–µ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Å—Ç–∞—Ç—å—è–º–∏ –ê–¥–∞–º–∞ –î–∂–æ–Ω—Å–æ–Ω–∞, –≥–¥–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

1. [Using Django Check Constraints to Ensure Only One Field Is Set](https://adamj.eu/tech/2020/03/25/django-check-constraints-one-field-set/)
2. [Django's Field Choices Don't Constrain Your Data](https://adamj.eu/tech/2020/01/22/djangos-field-choices-dont-constrain-your-data/)
3. [Using Django Check Constraints to Prevent Self-Following](https://adamj.eu/tech/2021/02/26/django-check-constraints-prevent-self-following/)

> –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: Constraint –∫–æ–Ω–µ—á–Ω–æ –∂–µ –º–æ—â–Ω–∞—è —à—Ç—É–∫–∞, –Ω–æ —Å –Ω–µ–π –Ω—É–∂–Ω–æ –±—ã—Ç—å –¥–æ–≤–æ–ª—å–Ω–æ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–º, –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ —Å–µ–±–µ –ø–æ –Ω–æ–≥–∞–º –ø–∞–ª—å–Ω—É—Ç—å.
> –ü–æ—ç—Ç–æ–º—É –µ—Å–ª–∏ –≤—ã —Ä–µ—à–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ, —Ç–æ –Ω–µ –ø–æ–ª–µ–Ω–∏—Ç–µ—Å—å –∑–∞—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å)

### –°–≤–æ–π—Å—Ç–≤–∞

–°–≤–æ–π—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏ - —ç—Ç–æ –æ—Ç–ª–∏—á–Ω—ã–π —Å–ø–æ—Å–æ–± –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–ª—é –∏–∑ –æ–±—ä–µ–∫—Ç–∞ –º–æ–¥–µ–ª–∏.

–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Å–≤–æ–π—Å—Ç–≤–∞ `has_started` –∏ `has_finished` –Ω–∞—à–µ–π –º–æ–¥–µ–ª–∏ `Course`:

```python
from django.utils import timezone
from django.core.exceptions import ValidationError


class Course(BaseModel):
    name = models.CharField(unique=True, max_length=255)

    start_date = models.DateField()
    end_date = models.DateField()

    def clean(self):
        if self.start_date >= self.end_date:
            raise ValidationError("–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –Ω–∞—á–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã")

    @property
    def has_started(self) -> bool:
        now = timezone.now()

        return self.start_date <= now.date()

    @property
    def has_finished(self) -> bool:
        now = timezone.now()

        return self.end_date <= now.date()
```

–≠—Ç–∏ —Å–≤–æ–π—Å—Ç–≤–∞ —É–¥–æ–±–Ω—ã, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –Ω–∏—Ö –≤ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞—Ö –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –≤ —à–∞–±–ª–æ–Ω–∞—Ö.

**–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—â–∏—Ö –ø—Ä–∞–≤–∏–ª, –∫–æ–≥–¥–∞ —Å–ª–µ–¥—É–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞ –≤ –º–æ–¥–µ–ª—å:**.

1. –ï—Å–ª–∏ –Ω–∞–º –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞ **–Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª—è—Ö**.
2. –ï—Å–ª–∏ —Ä–∞—Å—á–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç (–º–µ–Ω—å—à–µ 10 —Å—Ç—Ä–æ–∫).

**–°–≤–æ–π—Å—Ç–≤–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–µ–º-—Ç–æ –¥—Ä—É–≥–∏–º (—Å–µ—Ä–≤–∏—Å–æ–º, —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º, —É—Ç–∏–ª–∏—Ç–æ–π) –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ª—É—á–∞—è—Ö:**.

1. –ï—Å–ª–∏ –Ω–∞–º –Ω—É–∂–Ω–æ –æ—Ö–≤–∞—Ç–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ(–∏–∑ CRM –Ω–∞–ø—Ä–∏–º–µ—Ä).
2. –ï—Å–ª–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã–µ.

–ò–º–µ–π—Ç–µ –≤ –≤–∏–¥—É, —á—Ç–æ —ç—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞—Å–ø–ª—ã–≤—á–∞—Ç—ã, –ø–æ—Ç–æ–º—É —á—Ç–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–∞—à–µ–π –∑–∞–¥–∞—á–∏ —Ç–æ–∂–µ –æ—á–µ–Ω—å –≤–∞–∂–µ–Ω. –ö–∞—Ä–æ—á –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ **–∑–¥—Ä–∞–≤—ã–π —Å–º—ã—Å–ª.**

### –ú–µ—Ç–æ–¥—ã

–ú–µ—Ç–æ–¥—ã –º–æ–¥–µ–ª–∏ —Ç–∞–∫–∂–µ —è–≤–ª—è—é—Ç—Å—è –æ—á–µ–Ω—å –º–æ—â–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º, –Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –Ω—É–∂–Ω–æ –±–µ–∑ –æ—Å–æ–±–æ–≥–æ —Ñ–∞–Ω–∞—Ç–∏–∑–º–∞.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä —Å –º–µ—Ç–æ–¥–æ–º `is_within(self, x)`:

```python
from django.core.exceptions import ValidationError
from django.utils import timezone


class Course(BaseModel):
    name = models.CharField(unique=True, max_length=255)

    start_date = models.DateField()
    end_date = models.DateField()

    def clean(self):
        if self.start_date >= self.end_date:
            raise ValidationError("–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –Ω–∞—á–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã")

    @property
    def has_started(self) -> bool:
        now = timezone.now()

        return self.start_date <= now.date()

    @property
    def has_finished(self) -> bool:
        now = timezone.now()

        return self.end_date <= now.date()

    def is_within(self, x: date) -> bool:
        return self.start_date <= x <= self.end_date
```

`is_within` –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ–º, —Ç–∞–∫ –∫–∞–∫ —Ç—Ä–µ–±—É–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç–∞. –ü–æ—ç—Ç–æ–º—É –≤–º–µ—Å—Ç–æ –Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥.

–ï—â–µ –æ–¥–∏–Ω –æ—Ç–ª–∏—á–Ω—ã–π —Å–ø–æ—Å–æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤ –≤ –º–æ–¥–µ–ª—è—Ö - —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏—Ö –¥–ª—è **—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤**, –∫–æ–≥–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–¥–Ω–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞ –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞—Ç—å—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –¥—Ä—É–≥–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞ —Å –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º.

–ü—Ä–∏–º–µ—Ä:

```python
from django.utils.crypto import get_random_string
from django.conf import settings
from django.utils import timezone


class Token(BaseModel):
    secret = models.CharField(max_length=255, unique=True)
    expiry = models.DateTimeField(blank=True, null=True)

    def set_new_secret(self):
        now = timezone.now()

        self.secret = get_random_string(255)
        self.expiry = now + settings.TOKEN_EXPIRY_TIMEDELTA

        return self
```

–¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º —Å–º–µ–ª–æ –≤—ã–∑—ã–≤–∞—Ç—å `set_new_secret`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–∞—Å—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è `secret` –∏ `expiry`.

**–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—â–∏—Ö –ø—Ä–∞–≤–∏–ª, –∫–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å –º–µ—Ç–æ–¥—ã –≤ –º–æ–¥–µ–ª—å:**.

1. –ï—Å–ª–∏ –Ω–∞–º –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç—Ä–µ–±—É—é—â–µ–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞ **–Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª—è—Ö**, –¥–æ–±–∞–≤—å—Ç–µ –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Ç–æ–¥.
2. –ï—Å–ª–∏ —Ä–∞—Å—á–µ—Ç –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞ –ø—Ä–æ—Å—Ç–∞(–º–µ–Ω—å—à–µ 10 —Å—Ç—Ä–æ–∫).
3. –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–¥–Ω–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞ –≤—Å–µ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π –¥—Ä—É–≥–∏—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ—Ç–æ–¥ –¥–ª—è —ç—Ç–æ–≥–æ.

**–ú–µ—Ç–æ–¥ –¥–æ–ª–∂–Ω –±—ã—Ç—å —á–µ–º-—Ç–æ –¥—Ä—É–≥–∏–º (—Å–µ—Ä–≤–∏—Å–æ–º, —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º, —É—Ç–∏–ª–∏—Ç–æ–π) –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ª—É—á–∞—è—Ö:**.

1. –ï—Å–ª–∏ –Ω–∞–º –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
2. –ï—Å–ª–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã–µ(–±–æ–ª—å—à–µ 10 —Å—Ç—Ä–æ–∫).

–ò–º–µ–π—Ç–µ –≤ –≤–∏–¥—É, —á—Ç–æ —ç—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞—Å–ø–ª—ã–≤—á–∞—Ç—ã, –ø–æ—Ç–æ–º—É —á—Ç–æ —á–∞—Å—Ç–æ –≤–∞–∂–Ω–∞ –≤–∞—à–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∑–∞–¥–∞—á–∞. –ö–∞—Ä–æ—á –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ **–∑–¥—Ä–∞–≤—ã–π —Å–º—ã—Å–ª.**

## –°–µ—Ä–≤–∏—Å—ã

–°–µ—Ä–≤–∏—Å—ã - —ç—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ –∂–∏–≤–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –∏ –æ–±–∏—Ç–∞–µ—Ç –Ω–µ—Å–º–µ—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–≥–æ–≤.

–°–µ—Ä–≤–∏—Å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–æ–º —è–∑—ã–∫–µ –¥–æ–º–µ–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è, –º–æ–∂–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –¥—Ä—É–≥–∏–º —Ä–µ—Å—É—Ä—Å–∞–º, –∞ —Ç–∞–∫–∂–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ —á–∞—Å—Ç—è–º–∏ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º—ã.

–í–æ—Ç –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞, –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É—é—â–∞—è —Å–µ—Ä–≤–∏—Å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –≤ –Ω–∞—à–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö Django:

![Service layer](https://user-images.githubusercontent.com/387867/134778130-be168592-b953-4b74-8588-a3dbaa0b6871.png)

–°–µ—Ä–≤–∏—Å –º–æ–∂–µ—Ç –±—ã—Ç—å:

- –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è.
- –ö–ª–∞—Å—Å–æ–º.
- –¶–µ–ª—ã–º –º–æ–¥—É–ª–µ–º.
- –í—Å–µ, —á—Ç–æ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –≤ –≤–∞—à–µ–º —Å–ª—É—á–∞–µ.

–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ —Å–µ—Ä–≤–∏—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ—Å—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π, –∫–æ—Ç–æ—Ä–∞—è:

- –ù–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –º–æ–¥—É–ª–µ `<–≤–∞—à–µ_–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ>/services.py`.
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Ç–æ–ª—å–∫–æ –≤ –≤–∏–¥–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤, –µ—Å–ª–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –æ–¥–Ω–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞.
- –ê–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ —Ç–∏–ø—É (–¥–∞–∂–µ –µ—Å–ª–∏ –≤—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ [`mypy`](https://github.com/python/mypy) –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç).
- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, –¥—Ä—É–≥–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ –¥—Ä—É–≥–∏–º–∏ —á–∞—Å—Ç—è–º–∏ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º—ã.
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É - –æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ –¥–æ —Å–ª–æ–∂–Ω—ã—Ö —Å–∫–≤–æ–∑–Ω—ã—Ö –∑–∞–¥–∞—á, –≤—ã–∑–æ–≤–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –∑–∞–¥–∞—á.

–ü—Ä–∏–º–µ—Ä —Å–µ—Ä–≤–∏—Å–∞, —Å–æ–∑–¥–∞—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```python
def user_create(*, email: str, name: str) -> User:
    user = User(email=email)
    user.full_clean()
    user.save()

    profile_create(user=user, name=name)
    confirmation_email_send(user=user)

    return user
```

–ö–∞–∫ –≤—ã –≤–∏–¥–∏—Ç–µ, —ç—Ç–∞ —Å–ª—É–∂–±–∞ –≤—ã–∑—ã–≤–∞–µ—Ç 2 –¥—Ä—É–≥–∏–µ —Å–ª—É–∂–±—ã - `profile_create` –∏ `confirmation_email_send`.

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –≤—Å–µ, —á—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Å–ª–µ–∂–µ–Ω–æ.

### –°–æ–≥–ª–∞—à–µ–Ω–∏–µ –æ–± –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏

–ï—Å–ª–∏ –≤–∑—è—Ç—å –ø—Ä–∏–º–µ—Ä –≤—ã—à–µ, —Ç–æ –Ω–∞—à —Å–µ—Ä–≤–∏—Å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `user_create`. –®–∞–±–ª–æ–Ω - `<—Å—É—â–Ω–æ—Å—Ç—å>_<–¥–µ–π—Å—Ç–≤–∏–µ>`.

–ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è "–≤–æ –≤–Ω–µ", —Ç.–µ. –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–æ–≤, –∏ –Ω–∞–ø—Ä—è–º—É—é –Ω–∏–≥–¥–µ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è,
—Ç–æ –ª—É—á—à–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å `_` –ø–µ—Ä–µ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º –º–µ—Ç–æ–¥–∞. –ù–∞–ø—Ä–∏–º–µ—Ä `def _user_create()`

–í –∏—Ç–æ–≥–µ –º—ã –ø–æ–ª—É—á–∏–º:

1. –ï–¥–∏–Ω–æ—Ä–æ–¥–Ω—ã–π –Ω–µ–π–º–∏–Ω–≥
2. –ë—ã—Å—Ç—Ä–æ–π –ø–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —á–µ—Ä–µ–∑ ctrl+shift+f

### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

–ï—Å–ª–∏ —É –≤–∞—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Django —Å –∫—É—á–µ–π —Å–µ—Ä–≤–∏—Å–æ–≤, –≤—Å–µ –æ–Ω–∏ –º–æ–≥—É—Ç —Å—á–∞—Å—Ç–ª–∏–≤–æ –∂–∏—Ç—å –≤ –º–æ–¥—É–ª–µ `service.py`.

–ù–æ –∫–æ–≥–¥–∞ –≤—Å–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–æ–ª—å—à–∏–º, –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞—Ö–æ—Ç–µ—Ç—å —Ä–∞–∑–¥–µ–ª–∏—Ç—å `services.py` –Ω–∞ –ø–∞–ø–∫—É —Å –ø–æ–¥–º–æ–¥—É–ª—è–º–∏, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –≤—ã –∏–º–µ–µ—Ç–µ –¥–µ–ª–æ –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `authentication`, –≥–¥–µ —É –Ω–∞—Å –µ—Å—Ç—å 1 –ø–æ–¥–º–æ–¥—É–ª—å –≤ –º–æ–¥—É–ª–µ `services`, –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –¥–µ–ª–æ —Å `jwt`, –∏ –æ–¥–∏–Ω –ø–æ–¥–º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –¥–µ–ª–æ —Å `oauth`.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```
services
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ jwt.py
‚îî‚îÄ‚îÄ oauth.py
```

> –¢—É—Ç –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ: –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ, —Ç–æ –Ω—É–∂–Ω–æ –µ–≥–æ –ø—Ä–æ–∫–∏–Ω—É—Ç—å –≤ `__init__.py`.
> –ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –º–æ–¥—É–ª—è `services`, —Ç–æ –Ω–µ–π–º–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `_` –ø–µ—Ä–µ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º, –ø—Ä–∏–º–µ—Ä: `def _user_create()`

### –°–µ–ª–µ–∫—Ç–æ—Ä—ã

–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –Ω–∞—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –º—ã —Ä–∞–∑–ª–∏—á–∞–µ–º "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö" –∏ "–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö":

1. –û –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞–±–æ—Ç—è—Ç—Å—è —Å–µ—Ä–≤–∏—Å—ã.
2. **–°–µ–ª–µ–∫—Ç–æ—Ä—ã –∑–∞–±–æ—Ç—è—Ç—Å—è –æ–± –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö**.
3. –°–µ–ª–µ–∫—Ç–æ—Ä—ã –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞–∫ "—Ä–∞–∑–Ω–æ–≤–∏–¥–Ω–æ—Å—Ç—å—é" —Å–µ—Ä–≤–∏—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

–°–µ–ª–µ–∫—Ç–æ—Ä –ø–æ–¥—á–∏–Ω—è–µ—Ç—Å—è —Ç–µ–º –∂–µ –ø—Ä–∞–≤–∏–ª–∞–º, —á—Ç–æ –∏ —Å–µ—Ä–≤–∏—Å.

–ù–∞–ø—Ä–∏–º–µ—Ä, –≤ –º–æ–¥—É–ª–µ `<–≤–∞—à–µ_–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ>/selectors.py`, –º—ã –º–æ–∂–µ–º –∏–º–µ—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ:

```python
def user_list(*, fetched_by: User) -> Iterable[User]:
    user_ids = user_get_visible_for(user=fetched_by)

    query = Q(id__in=user_ids)

    return User.objects.filter(query)
```

–ö–∞–∫ –≤—ã –≤–∏–¥–∏—Ç–µ, `user_get_visible_for` - —ç—Ç–æ –æ–¥–∏–Ω —Å–µ–ª–µ–∫—Ç–æ—Ä.

–í—ã –º–æ–∂–µ—Ç–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–∞–±–æ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤, –∏–ª–∏ —Å–ø–∏—Å–∫–∏, –∏–ª–∏ –≤—Å–µ, —á—Ç–æ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –≤ –≤–∞—à–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Å–ª—É—á–∞–µ.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–∫–æ–ª—å–∫—É —Å–µ—Ä–≤–∏—Å—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –Ω–∞—à—É –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, –æ–Ω–∏ —è–≤–ª—è—é—Ç—Å—è –∏–¥–µ–∞–ª—å–Ω—ã–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–º –¥–ª—è —Ç–µ—Å—Ç–æ–≤.

–ï—Å–ª–∏ –≤—ã —Ä–µ—à–∏–ª–∏ –ø–æ–∫—Ä—ã—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Ç–µ—Å—Ç–∞–º–∏, —É –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—â–∏—Ö –ø—Ä–∞–≤–∏–ª, –∫–æ—Ç–æ—Ä—ã–º —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è:

1. –¢–µ—Å—Ç—ã **–¥–æ–ª–∂–Ω—ã –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∏–º –æ–±—Ä–∞–∑–æ–º –æ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É**. –í–æ–æ–±—â–µ –∏–¥–µ–∞–ª—å–Ω–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –µ—â–µ –±—É–¥–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ 1 —Ç–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤–µ—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—É—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞–∫–æ–≥–æ –Ω–∏–±—É–¥—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.
2. –¢–µ—Å—Ç—ã **–¥–æ–ª–∂–Ω—ã –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö** - —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —á—Ç–µ–Ω–∏–µ –∏–∑ –Ω–µ–µ.
3. –¢–µ—Å—Ç—ã **–¥–æ–ª–∂–Ω—ã –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –∏ –≤—Å–µ, —á—Ç–æ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –ø—Ä–æ–µ–∫—Ç–∞**.

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –∏–∑:

- –§–µ–π–∫–æ–≤ [faker](https://github.com/joke2k/faker)
- –§–∞–±—Ä–∏–∫–∏ [factory_boy](https://factoryboy.readthedocs.io/en/latest/orms.html)

**–î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –Ω–∞—à —Å–µ—Ä–≤–∏—Å –∏–∑ –ø—Ä–∏–º–µ—Ä–∞:**.

```python
from django.contrib.auth.models import User
from django.core.exceptions import ValidationError

from project.payments.selectors import items_get_for_user
from project.payments.models import Item, Payment
from project.payments.tasks import payment_charge


def item_buy(
    *,
    item: Item,
    user: User,
) -> Payment:
    if item in items_get_for_user(user=user):
        raise ValidationError(f'Item {item} already in {user} items.')

    payment = Payment.objects.create(
        item=item,
        user=user,
        successful=False
    )

    payment_charge.delay(payment_id=payment.id)

    return payment
```

–°–µ—Ä–≤–∏—Å:

- –í—ã–∑—ã–≤–∞–µ—Ç —Å–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
- –°–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç.
- –ò –∑–∞–ø—É—Å–∫–∞–µ—Ç celery —Ç–∞—Å–∫—É.

**–≠—Ç–æ –Ω–∞—à–∏ —Ç–µ—Å—Ç—ã:**

```python
from unittest.mock import patch

from django.test import TestCase
from django.contrib.auth.models import User
from django.core.exceptions import ValidationError

from django_styleguide.payments.services import item_buy
from django_styleguide.payments.models import Payment, Item


class ItemBuyTests(TestCase):
    def setUp(self):
        self.user = User.objects.create_user(username='Test User')
        self.item = Item.objects.create(
            name='Test Item',
            description='–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞',
            —Ü–µ–Ω–∞=10.15
        )

    @patch('project.payments.services.items_get_for_user')
    def test_buying_item_that_is_already_bought_fails(self, items_get_for_user_mock):
        """
        –ü–æ—Å–∫–æ–ª—å–∫—É —É –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è `items_get_for_user`,
        –º—ã –º–æ–∂–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–∏–∑–¥–µ–≤–∞—Ç—å—Å—è –Ω–∞–¥ –Ω–∏–º –∑–¥–µ—Å—å –∏ –¥–∞—Ç—å –µ–º—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
        """
        items_get_for_user_mock.return_value = [self.item]

        with self.assertRaises(ValidationError):
            item_buy(user=self.user, item=self.item)

    @patch('project.payments.services.payment_charge.delay')
    def test_buying_item_creates_a_payment_and_calls_charge_task(
        self,
        payment_charge_mock
    ):
        self.assertEqual(0, Payment.objects.count())

        payment = item_buy(user=self.user, item=self.item)

        self.assertEqual(1, Payment.objects.count())
        self.assertEqual(payment, Payment.objects.first())

        self.assertFalse(payment.successful)

        payment_charge_mock.assert_called()
```

## APIs & Serializers

> –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –≤–æ—Ç –∑–¥–µ—Å—å —è —Å–∏–ª—å–Ω–æ –ø–æ—Ä–µ–∑–∞–ª –∏—Å—Ö–æ–¥–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, —Ç.–∫. –Ω–µ —Å–æ–≤—Å–µ–º–∏ –≤–µ—â–∞–º–∏ —Å–æ–≥–ª–∞—Å–µ–Ω. –£ –Ω–∏—Ö –ø–æ–ª—É—á–∞–µ—Ç –æ—á–µ–Ω—å –º–Ω–æ–≥–æ –ª–∏—à–Ω–µ–≥–æ –∫–æ–¥–∞.
> –ù–∞–º –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤ OpenAPI3.0, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞—à —Ç–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥.

## Serializers

**–í–æ—Ç –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ API:**.

- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π **–≤—Ö–æ–¥–Ω–æ–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä** –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π **–≤—ã—Ö–æ–¥–Ω–æ–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä**.
- **–í—Ö–æ–¥–Ω–æ–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä** –∑–∞–±–æ—Ç–∏—Ç—Å—è –æ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
- **–í—ã—Ö–æ–¥–Ω–æ–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä** –∑–∞–±–æ—Ç–∏—Ç—Å—è –æ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
- –î–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤ –ª—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `serializers` –≤ –∫–æ—Ä–Ω–µ –º–æ–¥—É–ª—è. –ò —Ç–∞–º —Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π API –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –ø–∞–ø–∫–µ.

**–í —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤ DRF, –≤–æ—Ç –ø—Ä–∞–≤–∏–ª–∞:**

- –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è –ª–∏–±–æ `InputSerializer`, –ª–∏–±–æ `OutputSerializer`.
- –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é, –∫–æ–≥–¥–∞ —á—Ç–æ-—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è –≤ –±–∞–∑–æ–≤—ã—Ö —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞—Ö. –ü–æ—ç—Ç–æ–º—É –ª—É—á—à–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª—É—á–∞—è –∑–∞–≤–æ–¥–∏—Ç—å —Å–≤–æ–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä, –Ω–æ –±–µ–∑ —Ñ–∞–Ω–∞—Ç–∏–∑–º–∞.
- –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã, –≤ –∏–¥–µ–∞–ª–µ, –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–æ–ª—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –Ω–æ –Ω–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤.

### –°–æ–≥–ª–∞—à–µ–Ω–∏–µ –æ–± –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏

–î–ª—è API –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ –æ–± –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏: `<Entity><Action>Api`.

–í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä–æ–≤: `UserCreateApi`, `UserSendResetPasswordApi`, `UserDeactivateApi` –∏ —Ç.–¥.

### –§–∏–ª—å—Ç—Ä—ã

**–í–æ—Ç –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ API:**.

- –î–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ª—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `filters` –≤ –∫–æ—Ä–Ω–µ –º–æ–¥—É–ª—è. –ò —Ç–∞–º —Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π API –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –ø–∞–ø–∫–µ.
- –î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `specs` –∏ `facets`, –Ω—É–∂–Ω–æ –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç FacetFilterSet.

> –ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—Ç–µ —á—Ç–æ —Ç–∞–∫–æ–µ `specs` –∏ `facets`, –ø–æ–ø—Ä–æ—Å–∏—Ç–µ —Å–≤–æ–µ–≥–æ –º–µ–Ω—Ç–æ—Ä–∞ –∏–ª–∏ –ª–∏–¥–∞ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ —ç—Ç–æ. –≠—Ç–æ –≤–∞–∂–Ω–æ.

## –û—à–∏–±–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π - —ç—Ç–æ –±–æ–ª—å—à–∞—è —Ç–µ–º–∞ –∏ –¥–æ–≤–æ–ª—å–Ω–æ —á–∞—Å—Ç–æ - –¥–µ—Ç–∞–ª–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.

–ü–æ—ç—Ç–æ–º—É –º—ã —Ä–∞–∑–¥–µ–ª–∏–º –≤—Å–µ –Ω–∞ –¥–≤–µ —á–∞—Å—Ç–∏ - **–æ–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**, –∞ –∑–∞—Ç–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ **—Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –ø–æ–¥—Ö–æ–¥—ã** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫.

** –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Ç–∞–∫–æ–≤—ã:**

1. –ò–∑—É—á–∏—Ç–µ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –¥–ª—è Django Rest Framework).
2. –°–æ–≥–ª–∞—Å—É–π—Ç–µ, –∫–∞–∫ –¥–æ–ª–∂–Ω—ã –≤—ã–≥–ª—è–¥–µ—Ç—å –≤–∞—à–∏ –æ—à–∏–±–∫–∏ API —Å –≤–∞—à–∏–º–∏ —Ñ—Ä–æ–Ω—Ç–∞–º–∏, –ª–∏–±–æ —Å –≤–∞—à–∏–º –ª–∏–¥–æ–º

**–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤:**.

1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è DRF –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å –æ—á–µ–Ω—å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏.
2. –ü–æ–¥—Ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –±–æ–ª—å—à–∏—Ö –±–∏–∑–Ω–µ—Å –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä –≤ –û–Ω–ª–∞–π–Ω –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏).

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ DRF)

–í DRF –µ—Å—Ç—å –æ—Ç–ª–∏—á–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ —Ç–æ–º, –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –µ–≥–æ - <https://www.django-rest-framework.org/api-guide/exceptions/>.

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –≤–æ—Ç –∞–∫–∫—É—Ä–∞—Ç–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å –æ–±–∑–æ—Ä–æ–º –ø—Ä–æ—Ü–µ—Å—Å–∞:

![Exception handler (1)](https://user-images.githubusercontent.com/387867/142426205-2c0356e6-ce20-425e-a811-072c3334edb0.png)

–í –æ—Å–Ω–æ–≤–Ω–æ–º, –µ—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –Ω–µ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None`, —ç—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–º—É –∏—Å–∫–ª—é—á–µ–Ω–∏—é –∏ `500 Server Error`. –≠—Ç–æ —á–∞—Å—Ç–æ —Ö–æ—Ä–æ—à–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤—ã –Ω–µ –±—É–¥–µ—Ç–µ –∑–∞–º–∞–ª—á–∏–≤–∞—Ç—å –æ—à–∏–±–∫–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ.

**–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—á—É–¥—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–º –Ω—É–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ.**

#### DRF's `ValidationError`.

–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –º—ã –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–Ω–∏–º–µ–º `rest_framework.exceptions.ValidationError` –≤–æ—Ç —Ç–∞–∫:

```python
from rest_framework import exceptions


def some_service():
    raise ValidationError("–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –∑–¥–µ—Å—å.")
```

–û—Ç–≤–µ—Ç –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```json
[
    "–ù–µ–∫–æ—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
]
```

–≠—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç —Å—Ç—Ä–∞–Ω–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –µ—Å–ª–∏ –º—ã —Å–¥–µ–ª–∞–µ–º —ç—Ç–æ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```python
from rest_framework import exceptions


def some_service():
    raise exceptions.ValidationError({"error": "Some message"})
```

–û—Ç–≤–µ—Ç –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```json
{
    "error": "Some message"
}
```

–í –æ—Å–Ω–æ–≤–Ω–æ–º —ç—Ç–æ —Ç–æ, —á—Ç–æ –º—ã –ø–µ—Ä–µ–¥–∞–ª–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ `detail` –¥–ª—è `ValidationError`. –ù–æ —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –æ—Ç–ª–∏—á–Ω–∞—è –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞.

–¢–µ–ø–µ—Ä—å, –µ—Å–ª–∏ –º—ã —Ä–µ—à–∏–º –ø–æ–¥–Ω—è—Ç—å –µ—â–µ –æ–¥–Ω–æ –∏–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π DRF:

```python
from rest_framework import exceptions


def some_service():
    raise exceptions.NotFound()
```

–û—Ç–≤–µ—Ç –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```json
{
    "detail": "–ù–µ –Ω–∞–π–¥–µ–Ω–æ"
}
```

–≠—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –º—ã –≤–∏–¥–µ–ª–∏ –∫–∞–∫ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –æ—Ç `ValidationError`, –∏ —ç—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã.

–ü–æ–∫–∞ —á—Ç–æ, –ø–æ–≤–µ–¥–µ–Ω–∏–µ DRF –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –º–æ–∂–µ—Ç –¥–∞—Ç—å –Ω–∞–º:

- –ú–∞—Å—Å–∏–≤.
- –î–∏–∫—Ü–∏–æ–Ω–∞—Ä–∏–π.
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π `{"detail": "–û –±–æ–∂–µ –º–æ–π, –∫–∞–∫ —è –∑–∞–¥–æ–ª–±–∞–ª—Å—è –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –∏ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å —ç—Ç–æ —Å—Ç–∞–π–ª –≥–∞–π–¥!!!"}`

**–¢–∞–∫ —á—Ç–æ –µ—Å–ª–∏ –Ω–∞–º –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ DRF –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –º—ã –¥–æ–ª–∂–Ω—ã –ø–æ–∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ–± —ç—Ç–æ–º –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏.**.

#### Django's `ValidationError`.

–¢–µ–ø–µ—Ä—å, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ DRF –Ω–µ –≤ –ª–∞–¥–∞—Ö —Å `ValidationError` –≤ Django.

–í–æ—Ç —ç—Ç–æ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥–∞:

```python
from django.core.exceptions import ValidationError as DjangoValidationError


def some_service():
    raise DjangoValidationError("–ù–µ–∫–æ—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ")
```

–ü—Ä–∏–≤–µ–¥–µ—Ç –∫ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–º—É –∏—Å–∫–ª—é—á–µ–Ω–∏—é, –≤—ã–∑—ã–≤–∞—é—â–µ–º—É `500 Server Error`.

–≠—Ç–æ —Ç–∞–∫–∂–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç, –µ—Å–ª–∏ —ç—Ç–∞ `ValidationError` –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```python
def some_service():
    user = BaseUser()
    user.full_clean() # –í—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç ValidationError
    user.save()
```

–≠—Ç–æ —Ç–∞–∫–∂–µ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ `500 Server Error`.

–ï—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º –Ω–∞—á–∞—Ç—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —ç—Ç–æ, –∫–∞–∫ –µ—Å–ª–∏ –±—ã —ç—Ç–æ –±—ã–ª–∞ `rest_framework.exceptions.ValidationError`, –Ω–∞–º –Ω—É–∂–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞—à —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π [custom exception handler](https://www.django-rest-framework.org/api-guide/exceptions/#custom-exception-handling):

```python
from django.core.exceptions import ValidationError as DjangoValidationError

from rest_framework.views import exception_handler
from rest_framework.serializers import as_serializer_error
from rest_framework import exceptions


def custom_exception_handler(exc, ctx):
    if isinstance(exc, DjangoValidationError):
        exc = exceptions.ValidationError(as_serializer_error(exc))

    response = exception_handler(exc, ctx)

    # If unexpected error occurs (server error, etc.)
    if response is None:
        return response

    return response
```

–≠—Ç–æ, –ø–æ —Å—É—Ç–∏, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —ç—Ç–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –∫–æ–¥–∞:

```python
if isinstance(exc, DjangoValidationError):
    exc = exceptions.ValidationError(as_serializer_error(exc))
```

–ü–æ—Å–∫–æ–ª—å–∫—É –Ω–∞–º –Ω—É–∂–Ω–æ —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å `django.core.exceptions.ValidationError` –∏ `rest_framework.exceptions.ValidationError`, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º DRF `as_serializer_error`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Ç–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å Django's `ValidationError`, —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–π DRF.

### –ö–∞–∫ –¥–æ–ª–∂–Ω—ã –≤—ã–≥–ª—è–¥–µ—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ (–ø–æ–∫–∞ –Ω–µ –≤–Ω–µ–¥—Ä—è—Ç—å, –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏ —Ñ—Ä–æ–Ω—Ç–∞–º–∏)

–≠—Ç–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ –∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–¥–µ–ª–∞–Ω–æ –∫–∞–∫ –º–æ–∂–Ω–æ —Ä–∞–Ω—å—à–µ –≤ –ª—é–±–æ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ.

–ü–æ —Å—É—Ç–∏, —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤–∞—à–∏—Ö –æ—à–∏–±–æ–∫ API - **–ö–∞–∫ –æ—à–∏–±–∫–∞ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –≤ –≤–∏–¥–µ –æ—Ç–≤–µ—Ç–∞ API?**.

**–í–æ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–¥–µ–∏:**.

1. **–í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –∏–º–µ—Ç—å —Å–≤–æ—é —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –∏–µ—Ä–∞—Ä—Ö–∏—é –∏—Å–∫–ª—é—á–µ–Ω–∏–π**, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π.
2. –î–æ–ø—É—Å—Ç–∏–º, –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, —á—Ç–æ —É –Ω–∞—Å –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –æ—à–∏–±–∫–∞ - `ApplicationError`.
   1. –û–Ω–∞ –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ `core`, –≤ –º–æ–¥—É–ª–µ `exceptions`. –ü–æ —Å—É—Ç–∏, —É –Ω–∞—Å –±—É–¥–µ—Ç `project.core.exceptions.ApplicationError`.
3. –ú—ã —Ö–æ—Ç–∏–º –ø–æ–∑–≤–æ–ª–∏—Ç—å DRF –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
4. `ValidationError` —Ç–µ–ø–µ—Ä—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∏ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –ø–æ-–¥—Ä—É–≥–æ–º—É.
   1. –û—à–∏–±–∫–∞ `ValidationError` –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–Ω–∏–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏.

---

**–ú—ã —Å–æ–±–∏—Ä–∞–µ–º—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –Ω–∞—à–∏—Ö –æ—à–∏–±–æ–∫:**

```json
{
    "message": "–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –∑–¥–µ—Å—å",
    "extra": {}
}
```

–ö–ª—é—á `extra` –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É.

–ù–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–≥–¥–∞ —É –Ω–∞—Å –µ—Å—Ç—å `ValidationError` (–æ–±—ã—á–Ω–æ –∏—Å—Ö–æ–¥—è—â–∞—è –æ—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –∏–ª–∏ –º–æ–¥–µ–ª–∏), –º—ã —Å–æ–±–∏—Ä–∞–µ–º—Å—è –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```json
{
    "message": "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏",
    "extra": {
        "fields": {
              "password": [
                  "–≠—Ç–æ –ø–æ–ª–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"
              ],
              "email": [
                   "–≠—Ç–æ –ø–æ–ª–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"
              ]
        }
    }
}
```

–≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω–æ –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥, —á—Ç–æ–±—ã –æ–Ω–∏ –º–æ–≥–ª–∏ –∏—Å–∫–∞—Ç—å `extra.fields`, —á—Ç–æ–±—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —ç—Ç–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

–î–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```python
from django.core.exceptions import ValidationError as DjangoValidationError, PermissionDenied
from django.http import Http404

from rest_framework.views import exception_handler
from rest_framework import exceptions
from rest_framework.serializers import as_serializer_error
from rest_framework.response import Response

from styleguide_example.core.exceptions import ApplicationError


def custom_exception_handler(exc, ctx):
    """
    {
        "message": "Error message",
        "extra": {}
    }
    """
    if isinstance(exc, DjangoValidationError):
        exc = exceptions.ValidationError(as_serializer_error(exc))

    if isinstance(exc, Http404):
        exc = exceptions.NotFound()

    if isinstance(exc, PermissionDenied):
        exc = exceptions.PermissionDenied()

    response = exception_handler(exc, ctx)

    # –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ (–æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Ç.–¥.)
    if response is None:
        if isinstance(exc, ApplicationError):
            data = {
                "message": exc.message,
                "extra": exc.extra
            }
            return Response(data, status=400)

        return response

    if isinstance(exc.detail, (list, dict)):
        response.data = {
            "detail": response.data
        }

    if isinstance(exc, exceptions.ValidationError):
        response.data["message"] = "Validation error"
        response.data["extra"] = {
            "fields": response.data["detail"]
        }
    else:
        response.data["message"] = response.data["detail"]
        response.data["extra"] = {}

    del response.data["detail"]

    return response
```

–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —ç—Ç–æ—Ç –∫–æ–¥ –∏ –ø–æ–ø—ã—Ç–∞–π—Ç–µ—Å—å –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç. **–°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–∞–∫–æ–≤–∞ - –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –∏–∑ DRF –∏ –∑–∞—Ç–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å.**

–¢–µ–ø–µ—Ä—å –º—ã –±—É–¥–µ–º –∏–º–µ—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:

–ö–æ–¥:

```python
from styleguide_example.core.exceptions import ApplicationError


def trigger_application_error():
    raise ApplicationError(message="Something is not correct", extra={"type": "RANDOM"})
```

Response:

```json
{
    "message": "Something is not correct",
    "extra": {
        "type": "RANDOM"
    }
}
```

---

–ö–æ–¥:

```python
def some_service():
    raise DjangoValidationError("–ù–µ–∫–æ—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ")
```

Response:

```json
{
    "message": "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏",
    "extra": {
        "fields": {
            "non_field_errors": [
                "–ù–µ–∫–æ—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ"
            ]
        }
    }
}
```

---

–ö–æ–¥:

```python
from django.core.exceptions import PermissionDenied

def some_service():
    raise PermissionDenied()
```

Response:

```json
{
    "message": "–£ –≤–∞—Å –Ω–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è",
    "extra": {}
}
```

---

–ö–æ–¥:

```python
from django.http import Http404

def some_service():
    raise Http404()
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í –Ω–∞—à–∏—Ö Django –ø—Ä–æ–µ–∫—Ç–∞—Ö –º—ã —Ä–∞–∑–¥–µ–ª—è–µ–º –Ω–∞—à–∏ —Ç–µ—Å—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –æ–Ω–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç.

–¢–æ –µ—Å—Ç—å, –æ–±—ã—á–Ω–æ —É –Ω–∞—Å –µ—Å—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–µ–π, —Å–µ—Ä–≤–∏—Å–æ–≤, —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –∏ API / –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –æ–±—ã—á–Ω–æ –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```
–∏–º—è_–ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ –∏–º—è_–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ ‚îú‚îÄ‚îÄ __init__.py
‚îÇ ‚îî‚îÄ‚îÄ tests
‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ __init__.py
‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ models
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ __init__.py
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ test_some_model_name.py
‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ selectors
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ __init__.py
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ test_some_selector_name.py
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ services
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ __init__.py
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ test_some_service_name.py
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ user_story - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ __init__.py
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ user_online_booking.py - –ø–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–º–µ—â–µ–Ω–∏—è
‚îî‚îÄ‚îÄ __init__.py
```

### –°–æ–≥–ª–∞—à–µ–Ω–∏—è –æ–± –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏

–ú—ã —Å–ª–µ–¥—É–µ–º –¥–≤—É–º –æ–±—â–∏–º —Å–æ–≥–ª–∞—à–µ–Ω–∏—è–º –æ–± –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏:

- –ò–º–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `test_the_name_of_the_thing_that_that_is_tested.py`.
- –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `class TheNameOfTheThingThatIsTestedTests(TestCase):`.

–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —É –Ω–∞—Å –µ—Å—Ç—å:

```python
def a_very_neat_service(*args, **kwargs):
    pass
```

–ú—ã –ø–æ–ª—É—á–∏–º —Å–ª–µ–¥—É—é—â–µ–µ –∏–º—è —Ñ–∞–π–ª–∞:

```
project_name/app_name/tests/services/test_a_very_neat_service.py
```

–ò —Å–ª–µ–¥—É—é—â–µ–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–ª—É—á–∞—è:

```python
class AVeryNeatServiceTests(TestCase):
    pass
```

–î–ª—è —Ç–µ—Å—Ç–æ–≤ —Å–ª—É–∂–µ–±–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –º—ã —Å–ª–µ–¥—É–µ–º –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–π —Å—Ö–µ–º–µ.

–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —É –Ω–∞—Å –µ—Å—Ç—å `project_name/common/utils.py`, —Ç–æ –º—ã —Å–æ–±–∏—Ä–∞–µ–º—Å—è –∏–º–µ—Ç—å `project_name/common/tests/test_utils.py` –∏ –ø–æ–º–µ—Å—Ç–∏—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏ –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª.

–ï—Å–ª–∏ –º—ã —Ä–∞–∑–¥–µ–ª–∏–º –º–æ–¥—É–ª—å `utils.py` –Ω–∞ –ø–æ–¥–º–æ–¥—É–ª–∏, —Ç–æ —Ç–æ –∂–µ —Å–∞–º–æ–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∏ —Å —Ç–µ—Å—Ç–∞–º–∏:

- `project_name/common/utils/files.py`
- `project_name/common/tests/utils/test_files.py`.

## Celery

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º [Celery](http://www.celeryproject.org/) –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –æ–±—â–∏—Ö —Å–ª—É—á–∞–µ–≤:

- –û–±—â–µ–Ω–∏–µ —Å–æ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ (–æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å–µ–º, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —Ç.–¥.)
- –†–∞–∑–≥—Ä—É–∑–∫–∞ –±–æ–ª–µ–µ —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á –≤–Ω–µ HTTP-—Ü–∏–∫–ª–∞.
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Celery beat).

–ú—ã —Å—Ç–∞—Ä–∞–µ–º—Å—è –æ–±—Ä–∞—â–∞—Ç—å—Å—è —Å Celery —Ç–∞–∫, –∫–∞–∫ –±—É–¥—Ç–æ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –µ—â–µ –æ–¥–∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫ –Ω–∞—à–µ–π –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–µ - —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç - \*_–Ω–µ —Ä–∞–∑–º–µ—â–∞–π—Ç–µ —Ç–∞–º –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É_.

–ü—Ä–∏–º–µ—Ä –∑–∞–¥–∞—á–∏ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```python
from celery import shared_task

from project.app.services import some_service_name as service


@shared_task
def some_service_name(*args, **kwargs):
    service(*args, **kwargs)
```

–≠—Ç–æ –∑–∞–¥–∞—á–∞, –∏–º–µ—é—â–∞—è —Ç–æ –∂–µ –∏–º—è, —á—Ç–æ –∏ —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É.

**–ö–æ–Ω–µ—á–Ω–æ, –º–æ–≥—É—Ç –±—ã—Ç—å –∏ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏**, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ü–µ–ø–æ—á–∫–∞ –∏–ª–∏ —Å–≤—è–∑–∫–∞ –∑–∞–¥–∞—á, –∫–∞–∂–¥–∞—è –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–≤–æ—é –ª–æ–≥–∏–∫—É, —Å–≤—è–∑–∞–Ω–Ω—É—é —Å –¥–æ–º–µ–Ω–æ–º. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Ç—Ä—É–¥–Ω–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤ —Å–µ—Ä–≤–∏—Å–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏.

**–ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∑–Ω–∞–µ—Ç–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ —É–≤–µ—Ä–µ–Ω—ã –≤ —Ä–µ—à–µ–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ. –í—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –ª–∏–¥—É –∑–∞ –ø–æ–º–æ—â—å—é, –∏–ª–∏ –≤ backend –≤ mattermost**.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `celery` –≤ –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤ –ø–∞–ø–∫–µ settings (–æ–Ω–∞ –º–æ–∂–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è –ø–æ –¥—Ä—É–≥–æ–º—É, –Ω–æ –∫—Ä—á —Ä—è–¥–æ–º —Å —Ñ–∞–π–ª–æ–º settings.py).
–¢–∞–º –æ–ø–∏—Å–∞–Ω—ã –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—è–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π `Celery beat`

–ü—Ä–∏–º–µ—Ä–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

```python
import os

from celery import Celery
from django.conf import settings
from celery.schedules import crontab

os.environ.setdefault("DJANGO_SETTINGS_MODULE", "config.settings")


app = Celery(broker=settings.CELERY_BROKER_URL)
app.config_from_object("django.conf:settings")
app.autodiscover_tasks()
if not settings.DEBUG:
    app.conf.beat_schedule = {
        "scrape_all_accounts": {
            "task": "instagram.tasks.all_accounts_parse_instagram_posts_task",
            "schedule": crontab(day_of_week=1),
        },
        "update_stocks": {
            "task": "common.tasks.stock_expire_date",
            "schedule": crontab(day_of_week=1),
        },
        "update_mortgage": {
            "task": "common.tasks.update_mortgage",
            "schedule": crontab(minute=0, hour=0),
        },

    }


app.conf.task_annotations = {
    "common.tasks.save_remote_image": {"rate_limit": "300/m", "time_limit": 2}
}

if __name__ == "__main__":
    app.start()

```

#### Tasks –∏–ª–∏ –∂–µ –∑–∞–¥–∞—á–∏

–û–Ω–∏ —É –Ω–∞—Å —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ tasks.py, –≤ –∫–∞–∂–¥–æ–º –º–æ–¥—É–ª–µ –æ—Ç–¥–µ–ª—å–Ω–æ.

#### Celery beat –∏–ª–∏ –∑–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

- –î–ª—è –∑–∞–ø—É—Å–∫–∞ celery beat –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ, **–≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**. [–ü–æ—á–µ–º—É?](https://docs.celeryproject.org/en/stable/userguide/periodic-tasks.html#starting-the-scheduler)
